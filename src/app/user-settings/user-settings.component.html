<div class="settings-container">
  <div class="container py-5">
    <div *ngIf="isLoading" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Loading settings...</p>
    </div>

    <div
      *ngIf="errorMessage && !isLoading"
      class="alert alert-danger"
      role="alert"
    >
      {{ errorMessage }}
    </div>

    <div *ngIf="!isLoading && !errorMessage" class="row">
      <div class="col-md-3 mb-4 mb-md-0">
        <div class="card shadow settings-nav">
          <div class="list-group list-group-flush">
            <a
              *ngFor="let section of settingsSections"
              [class.active]="activeSection === section.id"
              (click)="setActiveSection(section.id)"
              class="list-group-item list-group-item-action d-flex align-items-center"
              href="javascript:void(0)"
            >
              <i class="bi {{ section.icon }} me-3"></i>
              {{ section.name }}
            </a>
          </div>
        </div>
      </div>

      <div class="col-md-9">
        <div
          *ngIf="successMessage"
          class="alert alert-success alert-dismissible fade show mb-4"
          role="alert"
        >
          {{ successMessage }}
          <button
            type="button"
            class="btn-close"
            (click)="successMessage = ''"
          ></button>
        </div>

        <div *ngIf="activeSection === 'account'" class="card shadow">
          <div class="card-header">
            <h5 class="mb-0">Account Settings</h5>
          </div>
          <div class="card-body p-4">
            <form [formGroup]="accountForm" (ngSubmit)="saveAccountSettings()">
              <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input
                  type="text"
                  class="form-control"
                  id="username"
                  formControlName="username"
                  [ngClass]="{
                    'is-invalid':
                      submitted && accountForm.get('username')?.errors
                  }"
                />
                <div
                  *ngIf="submitted && accountForm.get('username')?.errors"
                  class="invalid-feedback"
                >
                  <span
                    *ngIf="accountForm.get('username')?.errors?.['required']"
                    >Username is required</span
                  >
                </div>
              </div>

              <div class="mb-3">
                <label for="language" class="form-label">Language</label>
                <select
                  class="form-select"
                  id="language"
                  formControlName="language"
                >
                  <option value="en">English</option>
                  <option value="ar">Arabic</option>
                  <option value="fr">French</option>
                </select>
              </div>

              <div class="mb-3">
                <label for="timezone" class="form-label">Timezone</label>
                <select
                  class="form-select"
                  id="timezone"
                  formControlName="timezone"
                >
                  <option value="UTC">UTC (Coordinated Universal Time)</option>
                  <option value="EET">EET (Eastern European Time)</option>
                  <option value="AST">AST (Arabia Standard Time)</option>
                  <option value="GST">GST (Gulf Standard Time)</option>
                </select>
              </div>

              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="isSaving"
              >
                <span
                  *ngIf="isSaving"
                  class="spinner-border spinner-border-sm me-2"
                  role="status"
                  aria-hidden="true"
                ></span>
                Save Changes
              </button>
            </form>
          </div>
        </div>

        <div *ngIf="activeSection === 'notifications'" class="card shadow">
          <div class="card-header">
            <h5 class="mb-0">Notification Settings</h5>
          </div>
          <div class="card-body p-4">
            <form
              [formGroup]="notificationsForm"
              (ngSubmit)="saveNotificationSettings()"
            >
              <h6 class="mb-3">Email Notifications</h6>

              <div class="form-check form-switch mb-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="emailCourseUpdates"
                  formControlName="emailCourseUpdates"
                />
                <label class="form-check-label ms-2" for="emailCourseUpdates"
                  >Course updates and announcements</label
                >
              </div>

              <div class="form-check form-switch mb-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="emailAssignments"
                  formControlName="emailAssignments"
                />
                <label class="form-check-label ms-2" for="emailAssignments"
                  >Assignment reminders</label
                >
              </div>

              <div class="form-check form-switch mb-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="emailFeedback"
                  formControlName="emailFeedback"
                />
                <label class="form-check-label ms-2" for="emailFeedback"
                  >Feedback and grading</label
                >
              </div>

              <div class="form-check form-switch mb-4">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="emailMarketing"
                  formControlName="emailMarketing"
                />
                <label class="form-check-label ms-2" for="emailMarketing"
                  >Marketing and promotional emails</label
                >
              </div>

              <h6 class="mb-3">Platform Notifications</h6>

              <div class="form-check form-switch mb-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="platformMessages"
                  formControlName="platformMessages"
                />
                <label class="form-check-label ms-2" for="platformMessages"
                  >New messages</label
                >
              </div>

              <div class="form-check form-switch mb-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="platformCourseUpdates"
                  formControlName="platformCourseUpdates"
                />
                <label class="form-check-label ms-2" for="platformCourseUpdates"
                  >Course updates</label
                >
              </div>

              <div class="form-check form-switch mb-4">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="platformReminders"
                  formControlName="platformReminders"
                />
                <label class="form-check-label ms-2" for="platformReminders"
                  >Due date reminders</label
                >
              </div>

              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="isSaving"
              >
                <span
                  *ngIf="isSaving"
                  class="spinner-border spinner-border-sm me-2"
                  role="status"
                  aria-hidden="true"
                ></span>
                Save Changes
              </button>
            </form>
          </div>
        </div>

        <div *ngIf="activeSection === 'privacy'" class="card shadow">
          <div class="card-header">
            <h5 class="mb-0">Privacy Settings</h5>
          </div>
          <div class="card-body p-4">
            <form [formGroup]="privacyForm" (ngSubmit)="savePrivacySettings()">
              <h6 class="mb-3">Profile Visibility</h6>

              <div class="mb-3">
                <label class="form-label">Who can see your profile?</label>
                <div class="form-check mb-2">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="profileVisibility"
                    id="visibilityEveryone"
                    value="everyone"
                    formControlName="profileVisibility"
                  />
                  <label class="form-check-label" for="visibilityEveryone"
                    >Everyone</label
                  >
                </div>
                <div class="form-check mb-2">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="profileVisibility"
                    id="visibilityStudents"
                    value="students"
                    formControlName="profileVisibility"
                  />
                  <label class="form-check-label" for="visibilityStudents"
                    >Only students & instructors</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="profileVisibility"
                    id="visibilityNone"
                    value="none"
                    formControlName="profileVisibility"
                  />
                  <label class="form-check-label" for="visibilityNone"
                    >Private (only you)</label
                  >
                </div>
              </div>

              <h6 class="mb-3">Learning Activity</h6>

              <div class="form-check form-switch mb-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="shareProgress"
                  formControlName="shareProgress"
                />
                <label class="form-check-label ms-2" for="shareProgress"
                  >Share my learning progress with instructors</label
                >
              </div>

              <div class="form-check form-switch mb-4">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="shareCertificates"
                  formControlName="shareCertificates"
                />
                <label class="form-check-label ms-2" for="shareCertificates"
                  >Display my certificates on my profile</label
                >
              </div>

              <h6 class="mb-3">Data & Cookies</h6>

              <div class="form-check form-switch mb-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="allowAnalytics"
                  formControlName="allowAnalytics"
                />
                <label class="form-check-label ms-2" for="allowAnalytics"
                  >Allow analytics cookies to improve your experience</label
                >
              </div>

              <div class="form-check form-switch mb-4">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="allowMarketing"
                  formControlName="allowMarketing"
                />
                <label class="form-check-label ms-2" for="allowMarketing"
                  >Allow marketing cookies for personalized ads</label
                >
              </div>

              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="isSaving"
              >
                <span
                  *ngIf="isSaving"
                  class="spinner-border spinner-border-sm me-2"
                  role="status"
                  aria-hidden="true"
                ></span>
                Save Changes
              </button>
            </form>
          </div>
        </div>

        <div *ngIf="activeSection === 'security'" class="card shadow">
          <div class="card-header">
            <h5 class="mb-0">Security Settings</h5>
          </div>
          <div class="card-body p-4">
            <form
              [formGroup]="securityForm"
              (ngSubmit)="saveSecuritySettings()"
            >
              <h6 class="mb-3">Change Password</h6>

              <div class="mb-3">
                <label for="currentPassword" class="form-label"
                  >Current Password</label
                >
                <input
                  type="password"
                  class="form-control"
                  id="currentPassword"
                  formControlName="currentPassword"
                  [ngClass]="{
                    'is-invalid':
                      submitted && securityForm.get('currentPassword')?.errors
                  }"
                />
                <div
                  *ngIf="
                    submitted && securityForm.get('currentPassword')?.errors
                  "
                  class="invalid-feedback"
                >
                  <span
                    *ngIf="securityForm.get('currentPassword')?.errors?.['required']"
                    >Current password is required</span
                  >
                </div>
              </div>

              <div class="mb-3">
                <label for="newPassword" class="form-label">New Password</label>
                <input
                  type="password"
                  class="form-control"
                  id="newPassword"
                  formControlName="newPassword"
                  [ngClass]="{
                    'is-invalid':
                      submitted && securityForm.get('newPassword')?.errors
                  }"
                />
                <div
                  *ngIf="submitted && securityForm.get('newPassword')?.errors"
                  class="invalid-feedback"
                >
                  <span
                    *ngIf="securityForm.get('newPassword')?.errors?.['required']"
                    >New password is required</span
                  >
                  <span
                    *ngIf="securityForm.get('newPassword')?.errors?.['minlength']"
                    >Password must be at least 6 characters</span
                  >
                </div>
              </div>

              <div class="mb-4">
                <label for="confirmPassword" class="form-label"
                  >Confirm New Password</label
                >
                <input
                  type="password"
                  class="form-control"
                  id="confirmPassword"
                  formControlName="confirmPassword"
                  [ngClass]="{
                    'is-invalid':
                      submitted && securityForm.get('confirmPassword')?.errors
                  }"
                />
                <div
                  *ngIf="
                    submitted && securityForm.get('confirmPassword')?.errors
                  "
                  class="invalid-feedback"
                >
                  <span
                    *ngIf="securityForm.get('confirmPassword')?.errors?.['required']"
                    >Please confirm your password</span
                  >
                  <span
                    *ngIf="securityForm.get('confirmPassword')?.errors?.['passwordMismatch']"
                    >Passwords do not match</span
                  >
                </div>
              </div>

              <h6 class="mb-3">Two-Factor Authentication</h6>

              <div class="form-check form-switch mb-4">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="twoFactorAuth"
                  formControlName="twoFactorAuth"
                />
                <label class="form-check-label ms-2" for="twoFactorAuth">
                  Enable two-factor authentication
                </label>
              </div>

              <div
              *ngIf="securityForm.get('twoFactorAuth')?.value"
              class="mb-4 p-3 bg-body-secondary text-body rounded"
            >
                <h6>Setup Two-Factor Authentication</h6>
                <p class="text-muted small mb-3">
                  Two-factor authentication adds an extra layer of security to
                  your account.
                </p>
                <button type="button" class="btn btn-outline-primary btn-sm">
                  Setup Now
                </button>
              </div>

              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="isSaving"
              >
                <span
                  *ngIf="isSaving"
                  class="spinner-border spinner-border-sm me-2"
                  role="status"
                  aria-hidden="true"
                ></span>
                Save Changes
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
